<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Transtopia-alpha | 消息 </title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="plugins/bootstrap-3.3.6/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/font-awesome-4.7.0/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="plugins/ionicons-2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="plugins/AdminLTE-2.3.11/css/AdminLTE.min.css">
  <link rel="stylesheet" href="plugins/AdminLTE-2.3.11/css/skins/skin-purple.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="skin-purple sidebar-mini">
<div class="wrapper">
  <!-- Main Header -->
  <header class="main-header">
    <!-- Logo -->
    <a href="#" class="logo">
	  <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><b>T</b></span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>Transtopia</b></span>
    </a>

    <!-- Header Navbar -->
    <nav class="navbar navbar-default" role="navigation">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button"></a>
			<!-- Navbar Left Menu -->
				<!-- fill it here -->
			<!-- /.Navbar Left Menu -->
			
			<!-- Navbar Right Menu -->
				<!-- fill it here -->
			<!-- /.Navbar Right Menu -->
    </nav>
  </header>
	
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- search form (Optional) -->
      <form action="#" method="get" class="sidebar-form">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="搜索...">
              <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                </button>
              </span>
        </div>
      </form>
      <!-- /.search form -->
			<div class="sidebar-form" style="border: none;">
				<span class="col-xs-3"><a href="#" title="消息栏"><i class="fa fa-comment fa-2x"></i></a></span>
				<span class="col-xs-3"><a href="#" title="个人消息"><i class="fa fa-user fa-2x"></i></a></span>
				<span class="col-xs-3"><a href="#" title="群组消息"><i class="fa fa-users fa-2x"></i></a></span>
				<span class="col-xs-3"><a href="#" title="商品消息"><i class="fa fa-list fa-2x"></i></a></span>
			</div>
      <!-- Sidebar Menu -->
      <ul class="sidebar-menu sidebar-message">		
				<li class="header"><% 消息类型 %></li>
				<!-- Sidebar Tag for Message -->
      </ul>
      <!-- /.sidebar-menu -->
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Main content -->
    <section class="content">

    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="pull-right hidden-xs">
      <!-- Anything you want -->
    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; 2017 <a href="#">Transtopia</a>.</strong> All rights reserved.
  </footer>

  <!-- Control Sidebar -->
</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->
<!-- jQuery 2.2.3 -->
<script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="plugins/bootstrap-3.3.6/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="plugins/AdminLTE-2.3.11/js/app.min.js"></script>
<!-- Slimscroll -->
<script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.min.js"></script>

<!-- 我的JS -->
<style>
	/* 个人聊天栏 */
	/* 模态框居中 */
	#modalChatSendFile {
		text-align: center;
		padding: 0!important;
	}

	#modalChatSendFile:before {
		content: '';
		display: inline-block;
		height: 100%;
		vertical-align: middle;
		margin-right: -4px;
	}

	#modalChatSendFile .modal-dialog {
		display: inline-block;
		text-align: left;
		vertical-align: middle;
	}
	/* 模态框居中（结束） */
	
	.panel-chat {
		width:1080px;
		height:800px;
		background-color: rgb(255,255,255);
		border-radius: 3px;
		position: relative;
		left: 50%;
		transform: translateX(-50%)
	}
	.panel-chat-header {
		height: 50px;
		width: 100%;
		border-bottom: 1px solid #ddd;
		padding:14px 16px;"
	}
	.panel-chat-header a {
		 font-size: 18px;
		 color: #333;
		 font-family: Helvetica Neue,Helvetica,Nimbus Sans L,Arial,Liberation Sans,Hiragino Sans GB,Source Han Sans CN Normal,Microsoft YaHei,Wenquanyi Micro Hei,WenQuanYi Zen Hei,ST Heiti,SimHei,WenQuanYi Zen Hei Sharp,sans-serif;
	}
	.panel-chat-content {
		width: 100%;
		border-bottom: 1px solid #ddd;
		padding:14px 16px;
	}
	.panel-chat-message-time {
		font-size: 12px;
		color: #bbb;
		text-align: center;
	}
	.panel-chat-content-item {
		margin: 15px auto;
	}
	.panel-chat-content-item img{
		width:45px;
		height:auto;
		vertical-align: top"
	}
	.panel-chat-personal-message-text {
		line-height: 1.6;
		margin-left: 15px;
		padding: 8px 13px;
		display: inline-block;
		font-size: 14px;
		word-break: break-all;
		border-radius: 6px;
		border: 1px solid #ccc;
		max-width: 540px;"
	}
	.panel-chat-mine-message-text {
		float: right;
		line-height: 1.6;
		margin-left: 15px;
		padding: 8px 13px;
		display: inline-block;
		font-size: 14px;
		word-break: break-all;
		border-radius: 6px;
		border: 1px solid #ccc;
		max-width: 540px;"
	}
	.panel-chat-system-message-text {
		font-size: 12px;
		color: #bbb;
		text-align: center;
	}
	.panel-chat-input-toolbar {
		height: 40px;
		padding: 4px 15px;
		font-size: 20px;
	}
	.panel-chat-input-toolbar > a {
		margin-left: 15px;
		font-size: 21px;
		color: rgba(0,0,0,.5);
	}
	.panel-chat-textarea {
		z-index: auto;
		position: relative;
		line-height: 21px;
		font-size: 14px;
		transition: none;
		background: transparent !important;
		display: block;
		width: 100%;
		height: 130px;
		border: 0;
		resize: none;
		padding: 10px;
		outline: none;overflow-x: hidden;
		overflow-y: auto;
		box-sizing: border-box;
		border-radius: 4px;
	}
	.enter {
		color: rgba(0,0,0,.35);
		font-size: 13px;
		float: right;
		margin-right:15px;
		cursor: pointer;
	}
	/* 个人聊天栏（结束） */
</style>
<!-- 上传本地文件 -->
<link href="plugins/bootstrap-fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
<link href="plugins/bootstrap-fileinput/themes/explorer/theme.css" media="all" rel="stylesheet" type="text/css"/>
<script src="plugins/bootstrap-fileinput/js/plugins/sortable.js" type="text/javascript"></script>
<script src="plugins/bootstrap-fileinput/js/fileinput.js" type="text/javascript"></script>
<script src="plugins/bootstrap-fileinput/themes/explorer/theme.js" type="text/javascript"></script>
<script src="plugins/bootstrap-fileinput/js/locales/zh.js" type="text/javascript"></script>

<script>
	var loadChatHeader = function(data){
		//加载标题
		$(".panel-chat .panel-chat-header > a").remove();
		$(".panel-chat .panel-chat-header").append('<a href="#" data-container="body" data-trigger="hover" data-toggle="popover" data-placement="bottom" data-html="true" \
				data-content=\' \
							<div class="box box-primary" style="width:200px;"> \
							<div class="box-body box-profile"> \
								<img class="profile-user-img img-responsive img-circle" src="' + data.img + '" alt="User profile picture"> \
								<h3 class="profile-username text-center">' + data.name + '</h3> \
								<ul class="list-group list-group-unbordered"> \
								<li class="list-group-item"> \
									<b>动态</b> <a class="pull-right">' + data.blogs + '</a>\
								</li> \
								<li class="list-group-item"> \
									<b>精华</b> <a class="pull-right">' + data.popularblogs + '</a> \
								</li> \
								<li class="list-group-item"> \
									<b>关注者</b> <a class="pull-right">' + data.followers +'</a> \
								</li> \
								</ul> \
								<a href="#" class="btn btn-primary btn-block"><b>关注</b></a> \
							</div> \
							</div>\'><img class="img-circle" src="' + data.img + '" style="width: 30px;"> ' + data.name + '</a>');
	};
	
	var loadChatContent = function(data){
		//根据内容类型加载不同样式
		var loadChatMsg = function(data){
			if(data.type == 0)
				return data.text;
			else{
				var ext = data.src.substr(data.src.lastIndexOf('.') +1);
				if($.inArray(ext, ['jpg', 'png', 'gif']) != -1)
					return '<img class="img-responsive" src="' + data.src + '" style="width:500px;">'; //loadChatFile({filename: '这是一个文件.txt', src: 'dist/img/user7-128x128.jpg'})
				else
					return '<div class="info-box" style="margin:0;">\
										<span class="info-box-icon bg-yellow"><i class="fa fa-files-o"></i></span>\
										<div class="info-box-content" style="min-width:150px;">\
											<span class="info-box-number">' + data.filename + '</span>\
											<span class="info-box-text pull-right" style="margin-top: 20px;">\
												<a href="' + data.src + '" download style="margin: 10px;"><i class="fa fa-download"></i> 下载</a>\
												<a href="' + data.src + '" target="_blank><i class="fa fa-search"></i> 查看</a></span>\
									 </div>\
									</div>';
			}
		};
		
		$.each(data ,function(index, chat){
			//user_role  0：他人, 1: 自己， else： 系统消息
			if(chat.user_role == 0){
				$(".panel-chat-content").append(
					'<div class="panel-chat-content-item clearfix">\
						<p class="panel-chat-message-time">' + chat.time + '</p>\
						<div class="pull-left image">\
							<img class="img-circle" src="' + chat.user_img + '"  title="' + chat.user_name + '">\
						</div>\
						<div class="panel-chat-personal-message-text">' + loadChatMsg(chat.content) + '</div>\
					</div>'
					);
			}else if(chat.user_role == 1){
				$(".panel-chat-content").append(
					'<div class="panel-chat-content-item clearfix">\
						<p class="panel-chat-message-time">' + chat.time + '</p>\
						<div class="pull-right image" style="margin-left:15px;">\
							<img class="img-circle" src="' + chat.user_img + '" title="' + chat.user_name + '">\
						</div>\
						<div class="panel-chat-mine-message-text">' + loadChatMsg(chat.content) + '</div>\
					</div>');
			}else{
				$(".panel-chat-content").append(
					'<div class="panel-chat-content-item clearfix">\
						<p class="panel-chat-message-time">' + chat.time + '</p>\
						<p class="panel-chat-system-message-text">' + loadChatMsg(chat.content) + '</p>\
					</div>');
			}
			$('.panel-chat-content').slimScroll({
				scrollTo: $('.panel-chat-content')[0].scrollHeight
			});
		});
	};
	
	var initialChatPannel = function(){
		//添加Chat Box 和 上传文件的Modal
		$('.content-wrapper .content').html(
			'<div class="panel-chat">\
				<div class="panel-chat-header">\
					<a class="head-popover" href="#"></a>\
				</div>\
				<div class="panel-chat-content">\
				</div>\
				<div class="panel-chat-input">\
					<div class="panel-chat-input-toolbar">\
						<a href="#"><i class="fa fa-smile-o"></i></a>\
						<a href="#" data-toggle="modal" data-target="#modalChatSendFile"><i class="fa fa-paperclip"></i></a>\
						<a href="#"><i class="fa fa-send-o"></i></a>\
						<a href="#"><i class="fa fa-plus-circle"></i></a>\
					</div>\
				</div>\
				<textarea class="panel-chat-textarea" placeholder="说些什么..."></textarea>\
				<div class="enter"> 使用Ctrl + Enter发送</div>\
			</div>\
			\
			<div id="modalChatSendFile" class="modal fade">\
			<div class="modal-dialog">\
				<div class="modal-content">\
					<div class="modal-header">\
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">\
							<span aria-hidden="true">×</span></button>\
						<h4 class="modal-title">发送文件</h4>\
					</div>\
					<div class="modal-body">\
						<div class="nav-tabs-custom">\
							<ul class="nav nav-tabs pull-right">\
								<li><a href="#chatsendfile_cloud" data-toggle="tab"> 云盘云盘</a></li>\
								<li class="active"><a href="#chatsendfile_local" data-toggle="tab"> 本地文件</a></li>\
								<li class="pull-left header"><i class="fa fa-th"></i> 文件源位置</li>\
							</ul>\
							<div class="tab-content">\
								<div class="tab-pane" id="chatsendfile_cloud">\
									<b>云盘文件：</b>\
									<p style="text-align: center; margin: 100px auto;">云盘上传文件</p>\
								</div>\
								<div class="tab-pane active" id="chatsendfile_local">\
									<div class="form-group">\
										<label>本地文件： </label>\
										<input name="chatsendfile[]" id="fileinput_chatsendfile" type="file" multiple>\
										<br>\
									</div>\
								</div>\
							</div>\
						</div>\
					</div>\
				</div>\
			</div>\
		</div>'
		);
		
		//加载标题 （ajax）
		loadChatHeader(test_data_initial)
		
		//架子啊内容 （ajax）
		loadChatContent(test_data_content)
		
		//发送消息
		$( '.panel-chat-textarea').keypress(function(event){
			if(event.keyCode == 10){
				var text = $(this).val();
				$(this).val('');
				
				//发送消息
			}else{}
		});
		//发送消息（结束）
		
		//动态加载chat
		var dynamicLoadChat = function(){
			//loadChatContent(test_data_content);
			//获取data
			timer_chat = setTimeout(dynamicLoadChat, 1000);
		};
		var abortTimer = function(timer_chat) { // to be called when you want to stop the timer
			clearInterval(timer_chat);
		}
		var timer_chat = setTimeout(dynamicLoadChat, 1000);
		//动态加载chat（结束）

		//其他
		$("[data-toggle='popover']").popover();
		
		$('.panel-chat-content').slimScroll({
			height: '550px',
		});
		
		$("#fileinput_chatsendfile").fileinput({
				language: "zh",
				theme: 'explorer',
				uploadUrl: '#',
				overwriteInitial: false,
				initialPreviewAsData: false,
				uploadExtraData: {
					//在此添加ID 等等
					abc: 123
				}
		});
	};
	
	var test_data_initial = {
		'id': 123,
		'name': '张震宇',
		'img': 'dist/img/user7-128x128.jpg',
		'blogs': 95,
		'popularblogs': 15,
		'followers': 3751
		
	}

	var test_data_content = [{
			user_id: 5,
			user_name: '六月',
			user_img: 'dist/img/user7-128x128.jpg',
			time:'2016/05/31 - 15:07:05',
			content: {
				type: 0, //0: text; 1: file or picture;
				text:'这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息'
			},
			user_role: 1
		},{
			user_id: 5,
			user_name: '六月',
			user_img: 'dist/img/user7-128x128.jpg',
			time:'2016/05/31 - 15:07:04',
			content: {
				type: 0, //0: text; 1: file or picture;
				text:'这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息这是我的第一条消息'
			},
			user_role: 0
		},{
			user_id: 5,
			user_name: '六月',
			user_img: 'dist/img/user7-128x128.jpg',
			time:'2016/05/31 - 15:07:04',
			content: {
				type: 1, //0: text; 1: file or picture;
				filename:'这是一个文件.txt',
				src: 'dist/img/test/HELP-US-OUT.txt'
			},
			user_role: 1
		},{
			user_id: 5,
			user_name: '六月',
			user_img: 'dist/img/user7-128x128.jpg',
			time:'2016/05/31 - 15:07:04',
			content: {
				type: 0, //0: text; 1: file or picture;
				text:'这是一条系统消息'
			},
			user_role: 2
		},{
			user_id: 5,
			user_name: '六月',
			user_img: 'dist/img/user7-128x128.jpg',
			time:'2016/05/31 - 15:07:04',
			content: {
				type: 1, //0: text; 1: file or picture;
				filename:'这是一个文件.png',
				src: 'dist/img/photo1.png'
			},
			user_role: 0
		}];
</script>





</body>
</html>
